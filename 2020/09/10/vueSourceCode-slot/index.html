<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="记录前端学习生涯的点点滴滴">
  <meta name="keyword" content="前端,es6,html5,css3,js,webpack,vue">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Vue源码系列之slot插槽 | 前端博客
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/css/plugins/gitment.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    
<script src="/js/qrious.js"></script>

  
  
    
<script src="/js/gitment.js"></script>

  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


<meta name="generator" content="Hexo 4.2.0"></head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>前端博客</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">主页</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">标签</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">归档</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">开源项目</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">关于</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">主页</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">标签</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">归档</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">开源项目</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">关于</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>Vue源码系列之slot插槽</h2>
  <p class="post-date">2020-09-10</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h1 id="Vue源码系列之slot插槽"><a href="#Vue源码系列之slot插槽" class="headerlink" title="Vue源码系列之slot插槽"></a>Vue源码系列之slot插槽</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>在 2.6.0 中，我们为具名插槽和作用域插槽引入了一个新的统一的语法 (即 <code>v-slot</code> 指令)。它取代了 <code>slot</code> 和 <code>slot-scope</code> 这两个目前已被废弃但未被移除且仍在<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%BA%9F%E5%BC%83%E4%BA%86%E7%9A%84%E8%AF%AD%E6%B3%95" target="_blank" rel="noopener">文档中</a>的 attribute。新语法的由来可查阅这份 <a href="https://github.com/vuejs/rfcs/blob/master/active-rfcs/0001-new-slot-syntax.md" target="_blank" rel="noopener">RFC</a>。</p>
</blockquote>
<p>Vue 实现了一套内容分发的 API，这套 API 的设计灵感源自 <a href="https://github.com/w3c/webcomponents/blob/gh-pages/proposals/Slots-Proposal.md" target="_blank" rel="noopener">Web Components 规范草案</a>，将 <code>&lt;slot&gt;</code> 元素作为承载分发内容的出口。</p>
<h2 id="默认插槽"><a href="#默认插槽" class="headerlink" title="默认插槽"></a>默认插槽</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>我们来定义一个含有默认插槽的组件<code>SlotTemplate.vue</code>，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><p>当组件渲染的时候，<code>&lt;slot&gt;&lt;/slot&gt;</code> 将会被替换为“default slot”。插槽内可以包含任何模板代码，包括 HTML和其它组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span> default slot <span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br><span class="line">// 渲染：=&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  default slot</span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 含有html</span><br><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>xxxx<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  default slot</span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br><span class="line">// 渲染：=&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>xxxx<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  default slot</span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 含有其它组件</span><br><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">other-component</span>&gt;</span><span class="tag">&lt;/<span class="name">other-component</span>&gt;</span></span><br><span class="line">  default slot</span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br><span class="line">// 渲染：=&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"other-component"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  default slot</span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：如果组件的模板中没有包含一个 <code>&lt;slot&gt;</code> 元素，则该组件起始标签和结束标签之间的任何内容都会被抛弃。</p>
</blockquote>
<h3 id="后备内容"><a href="#后备内容" class="headerlink" title="后备内容"></a>后备内容</h3><p>有时为一个插槽设置具体的后备 (也就是默认的) 内容是很有用的，它只会在没有提供内容的时候被渲染。<br>我们来修改一下上面的<code>SlotTemplate.vue</code>组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span>我是补位选手<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 不提供任何插槽内容,后备内容将会被渲染</span><br><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br><span class="line">// 渲染：=&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  我是补位选手</span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 提供内容：提供的内容将会被渲染从而取代后备内容</span><br><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span></span><br><span class="line">  我是主力选手</span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br><span class="line">// 渲染：=&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  我是主力选手</span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h2><blockquote>
<p>自 2.6.0 起有所更新。已废弃的使用 <code>slot</code> attribute 的语法在<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%BA%9F%E5%BC%83%E4%BA%86%E7%9A%84%E8%AF%AD%E6%B3%95" target="_blank" rel="noopener">这里</a>。</p>
</blockquote>
<h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><ol>
<li><code>&lt;slot&gt;</code> 元素有一个特殊的 attribute：<code>name</code>。这个 attribute 可以用来定义额外的插槽。</li>
<li>一个不带 <code>name</code> 的 <code>&lt;slot&gt;</code> 出口会带有隐含的名字“default”。</li>
</ol>
<p>我们再来修改一下上面的<code>SlotTemplate.vue</code>组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"header"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"main"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"footer"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h3><p>在向具名插槽提供内容的时候，我们可以在一个 <code>&lt;template&gt;</code> 元素上使用 <code>v-slot</code> 指令，并以 <code>v-slot</code> 的参数的形式提供其名称：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是头部部分<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是主体内容部分<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>我会被默认插槽收留<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是底部部分<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>渲染：任何没有被包裹在带有 <code>v-slot</code> 的 <code>&lt;template&gt;</code> 中的内容都会被视为默认插槽的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是头部部分<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是主体内容部分<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>我会被默认插槽收留<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是底部部分<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：<code>v-slot</code> 只能添加在 <code>&lt;template&gt;</code> 上 (只有<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E7%8B%AC%E5%8D%A0%E9%BB%98%E8%AE%A4%E6%8F%92%E6%A7%BD%E7%9A%84%E7%BC%A9%E5%86%99%E8%AF%AD%E6%B3%95" target="_blank" rel="noopener">一种例外情况</a>)，这一点和已经废弃的 <code>slot</code> <a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%BA%9F%E5%BC%83%E4%BA%86%E7%9A%84%E8%AF%AD%E6%B3%95" target="_blank" rel="noopener">attribute</a> 不同。</p>
</blockquote>
<h3 id="缩写"><a href="#缩写" class="headerlink" title="缩写"></a>缩写</h3><blockquote>
<p>2.6.0 新增</p>
</blockquote>
<p>跟 v-on 和 v-bind 一样，v-slot 也有缩写，即把参数之前的所有内容 (v-slot:) 替换为字符 #。例如 v-slot:header 可以被重写为 #header：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">user</span>=<span class="string">"&#123; user &#125;"</span>&gt;</span></span><br><span class="line">    &#123;&#123; user.name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然而，和其它指令一样，该缩写只在其有参数的时候才可用。这意味着以下语法是无效的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这样会触发一个警告 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">slot-template</span> #=<span class="string">"&#123; user &#125;"</span>&gt;</span></span><br><span class="line">  &#123;&#123; user.firstName &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 如果你希望使用缩写的话，你必须始终以明确插槽名取而代之 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">slot-template</span> #<span class="attr">default</span>=<span class="string">"&#123; user &#125;"</span>&gt;</span></span><br><span class="line">  &#123;&#123; user.firstName &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="动态插槽名"><a href="#动态插槽名" class="headerlink" title="动态插槽名"></a>动态插槽名</h2><blockquote>
<p>2.6.0 新增</p>
</blockquote>
<p><a href="https://cn.vuejs.org/v2/guide/syntax.html#%E5%8A%A8%E6%80%81%E5%8F%82%E6%95%B0" target="_blank" rel="noopener">动态指令参数</a>也可以用在 v-slot 上，来定义动态的插槽名：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:</span>[<span class="attr">dynamicSlotName</span>]&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p>上面我们已经了解了默认插槽和具名插槽的用法，下面让我们来看看Vue内部是怎样实现的吧！<br>还是先从编译说起，我们知道编译是发生在调用 <code>vm.$mount</code> 的时候，所以编译的顺序是先编译父组件，再编译子组件。</p>
<h3 id="编译父组件阶段"><a href="#编译父组件阶段" class="headerlink" title="编译父组件阶段"></a>编译父组件阶段</h3><p>父组件编译在<code>parse</code>阶段，会执行<code>processSlotContent</code>函数处理<code>slot</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/parser/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// handle content being passed to a component as slot,</span></span><br><span class="line"><span class="comment">// e.g. &lt;template slot="xxx"&gt;, &lt;div slot-scope="xxx"&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processSlotContent</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/** v2.6.0 之前的语法兼容处理  slot="xxx" */</span></span><br><span class="line">  <span class="comment">// getBindingAttr 获取绑定的slot属性值或动态绑定(:或v-bind:)的值</span></span><br><span class="line">  <span class="keyword">const</span> slotTarget = getBindingAttr(el, <span class="string">'slot'</span>)</span><br><span class="line">  <span class="keyword">if</span> (slotTarget) &#123;</span><br><span class="line">    el.slotTarget = slotTarget === <span class="string">'""'</span> ? <span class="string">'"default"'</span> : slotTarget</span><br><span class="line">    el.slotTargetDynamic = !!(el.attrsMap[<span class="string">':slot'</span>] || el.attrsMap[<span class="string">'v-bind:slot'</span>])</span><br><span class="line">    <span class="comment">// preserve slot as an attribute for native shadow DOM compat</span></span><br><span class="line">    <span class="comment">// only for non-scoped slots.</span></span><br><span class="line">    <span class="keyword">if</span> (el.tag !== <span class="string">'template'</span> &amp;&amp; !el.slotScope) &#123;</span><br><span class="line">      addAttr(el, <span class="string">'slot'</span>, slotTarget, getRawBindingAttr(el, <span class="string">'slot'</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** v2.6.0 新增 */</span></span><br><span class="line">  <span class="comment">// 2.6 v-slot syntax</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NEW_SLOT_SYNTAX) &#123;</span><br><span class="line">    <span class="keyword">if</span> (el.tag === <span class="string">'template'</span>) &#123;</span><br><span class="line">      <span class="comment">// v-slot on &lt;template&gt;</span></span><br><span class="line">      <span class="comment">// const slotRE = /^v-slot(:|$)|^#/</span></span><br><span class="line">      <span class="keyword">const</span> slotBinding = getAndRemoveAttrByRegex(el, slotRE)</span><br><span class="line">      <span class="keyword">if</span> (slotBinding) &#123;</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (el.slotTarget || el.slotScope) &#123;</span><br><span class="line">            warn(</span><br><span class="line">              <span class="string">`Unexpected mixed usage of different slot syntaxes.`</span>,</span><br><span class="line">              el</span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (el.parent &amp;&amp; !maybeComponent(el.parent)) &#123;</span><br><span class="line">            warn(</span><br><span class="line">              <span class="string">`&lt;template v-slot&gt; can only appear at the root level inside `</span> +</span><br><span class="line">              <span class="string">`the receiving component`</span>,</span><br><span class="line">              el</span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> &#123; name, dynamic &#125; = getSlotName(slotBinding)</span><br><span class="line">        el.slotTarget = name</span><br><span class="line">        el.slotTargetDynamic = dynamic</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// v-slot on component, denotes default slot</span></span><br><span class="line">      <span class="keyword">const</span> slotBinding = getAndRemoveAttrByRegex(el, slotRE)</span><br><span class="line">      <span class="keyword">if</span> (slotBinding) &#123;</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!maybeComponent(el)) &#123;</span><br><span class="line">            warn(</span><br><span class="line">              <span class="string">`v-slot can only be used on components or &lt;template&gt;.`</span>,</span><br><span class="line">              slotBinding</span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (el.slotScope || el.slotTarget) &#123;</span><br><span class="line">            warn(</span><br><span class="line">              <span class="string">`Unexpected mixed usage of different slot syntaxes.`</span>,</span><br><span class="line">              el</span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (el.scopedSlots) &#123;</span><br><span class="line">            warn(</span><br><span class="line">              <span class="string">`To avoid scope ambiguity, the default slot should also use `</span> +</span><br><span class="line">              <span class="string">`&lt;template&gt; syntax when there are other named slots.`</span>,</span><br><span class="line">              slotBinding</span><br><span class="line">            )</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// add the component's children to its default slot</span></span><br><span class="line">        <span class="keyword">const</span> slots = el.scopedSlots || (el.scopedSlots = &#123;&#125;)</span><br><span class="line">        <span class="keyword">const</span> &#123; name, dynamic &#125; = getSlotName(slotBinding)</span><br><span class="line">        <span class="comment">// 如果不是template包裹插槽内容，就自动新建一个template模板包裹</span></span><br><span class="line">        <span class="keyword">const</span> slotContainer = slots[name] = createASTElement(<span class="string">'template'</span>, [], el)</span><br><span class="line">        slotContainer.slotTarget = name</span><br><span class="line">        slotContainer.slotTargetDynamic = dynamic</span><br><span class="line">        slotContainer.children = el.children.filter(<span class="function">(<span class="params">c: any</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!c.slotScope) &#123;</span><br><span class="line">            c.parent = slotContainer</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// remove children as they are returned from scopedSlots now</span></span><br><span class="line">        el.children = []</span><br><span class="line">        <span class="comment">// mark el non-plain so data gets generated</span></span><br><span class="line">        el.plain = <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSlotName</span> (<span class="params">binding</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> name = binding.name.replace(slotRE, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">if</span> (!name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (binding.name[<span class="number">0</span>] !== <span class="string">'#'</span>) &#123;</span><br><span class="line">      name = <span class="string">'default'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">`v-slot shorthand syntax requires a slot name.`</span>,</span><br><span class="line">        binding</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 动态插槽名称解析 const dynamicArgRE = /^\[.*\]$/</span></span><br><span class="line">  <span class="keyword">return</span> dynamicArgRE.test(name)</span><br><span class="line">    <span class="comment">// dynamic [name]</span></span><br><span class="line">    ? &#123; <span class="attr">name</span>: name.slice(<span class="number">1</span>, <span class="number">-1</span>), <span class="attr">dynamic</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    <span class="comment">// static name</span></span><br><span class="line">    : &#123; <span class="attr">name</span>: <span class="string">`"<span class="subst">$&#123;name&#125;</span>"`</span>, <span class="attr">dynamic</span>: <span class="literal">false</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当解析到标签上有 <code>slot</code> 属性的时候，会给对应的 AST 元素节点添加 <code>slotTarget</code> 属性，然后在 <code>codegen</code> 阶段，在 <code>genData</code> 中会处理 <code>slotTarget</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/codegen/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">genData</span> (<span class="params">el: ASTElement, state: CodegenState</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// slot target</span></span><br><span class="line">  <span class="comment">// only for non-scoped slots</span></span><br><span class="line">  <span class="keyword">if</span> (el.slotTarget &amp;&amp; !el.slotScope) &#123;</span><br><span class="line">    data += <span class="string">`slot:<span class="subst">$&#123;el.slotTarget&#125;</span>,`</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会给 data 添加一个 slot 属性，并指向 slotTarget，之后会用到。在我们的例子中，父组件最终生成的代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> _c(<span class="string">'slot-template'</span>,&#123;</span><br><span class="line">    scopedSlots:_u([&#123;</span><br><span class="line">      key:<span class="string">"main"</span>,</span><br><span class="line">      fn:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [_c(<span class="string">'p'</span>,[_v(<span class="string">"我是主体内容部分"</span>)])]</span><br><span class="line">      &#125;,</span><br><span class="line">      proxy:<span class="literal">true</span></span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        key:<span class="string">"footer"</span>,</span><br><span class="line">        fn:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> [_c(<span class="string">'p'</span>,[_v(<span class="string">"我是底部部分"</span>)])]</span><br><span class="line">        &#125;,</span><br><span class="line">        proxy:<span class="literal">true</span></span><br><span class="line">      &#125;])</span><br><span class="line">    &#125;,</span><br><span class="line">      [_c(<span class="string">'div'</span>,&#123;</span><br><span class="line">        attrs:&#123;<span class="string">"slot"</span>:<span class="string">"header"</span>&#125;,</span><br><span class="line">        slot:<span class="string">"header"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        [_c(<span class="string">'h1'</span>,[_v(<span class="string">"我是头部部分"</span>)])]</span><br><span class="line">      ),</span><br><span class="line">        _v(<span class="string">" "</span>),</span><br><span class="line">        _v(<span class="string">" "</span>),</span><br><span class="line">        _c(<span class="string">'p'</span>,[_v(<span class="string">"我会被默认插槽收留"</span>)])</span><br><span class="line">      ]</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编译子组件阶段"><a href="#编译子组件阶段" class="headerlink" title="编译子组件阶段"></a>编译子组件阶段</h3><p>在子组件编译时，在<code>parser</code>阶段会执行<code>processSlotOutlet</code>处理函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/parser/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// handle &lt;slot/&gt; outlets</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processSlotOutlet</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (el.tag === <span class="string">'slot'</span>) &#123;</span><br><span class="line">    el.slotName = getBindingAttr(el, <span class="string">'name'</span>)</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; el.key) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">`\`key\` does not work on &lt;slot&gt; because slots are abstract outlets `</span> +</span><br><span class="line">        <span class="string">`and can possibly expand into multiple elements. `</span> +</span><br><span class="line">        <span class="string">`Use the key on a wrapping element instead.`</span>,</span><br><span class="line">        getRawBindingAttr(el, <span class="string">'key'</span>)</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当遇到 <code>slot</code> 标签的时候会给对应的 AST 元素节点添加 <code>slotName</code> 属性，然后在 <code>codegen</code> 阶段，会判断如果当前 AST 元素节点是 <code>slot</code> 标签，则执行 <code>genSlot</code> 函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/codegen/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genSlot</span> (<span class="params">el: ASTElement, state: CodegenState</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> slotName = el.slotName || <span class="string">'"default"'</span></span><br><span class="line">  <span class="keyword">const</span> children = genChildren(el, state)</span><br><span class="line">  <span class="keyword">let</span> res = <span class="string">`_t(<span class="subst">$&#123;slotName&#125;</span><span class="subst">$&#123;children ? <span class="string">`,<span class="subst">$&#123;children&#125;</span>`</span> : <span class="string">''</span>&#125;</span>`</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// 我们先不考虑 slot 标签上有 attrs 以及 v-bind 的情况</span></span><br><span class="line">  <span class="keyword">return</span> res + <span class="string">')'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 <code>slotName</code> 从 AST 元素节点对应的属性上取，默认是 <code>default</code>，而 <code>children</code> 对应的就是 <code>slot</code> 开始和闭合标签包裹的内容。</p>
<p>在编译环节我们可以看到<code>_t</code> 函数对应的就是 <code>renderSlot</code> 方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/render-helpers/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">installRenderHelpers</span> (<span class="params">target: any</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  target._t = renderSlot</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/core/instance/render-heplpers/render-slot.js</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Runtime helper for rendering &lt;slot&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">renderSlot</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  name: string,</span></span></span><br><span class="line"><span class="function"><span class="params">  fallback: ?Array&lt;VNode&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  props: ?Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  bindObject: ?Object</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): ?<span class="title">Array</span>&lt;<span class="title">VNode</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> scopedSlotFn = <span class="keyword">this</span>.$scopedSlots[name]</span><br><span class="line">  <span class="keyword">let</span> nodes</span><br><span class="line">  <span class="keyword">if</span> (scopedSlotFn) &#123; <span class="comment">// scoped slot</span></span><br><span class="line">    props = props || &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (bindObject) &#123;</span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !isObject(bindObject)) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="string">'slot v-bind without argument expects an Object'</span>,</span><br><span class="line">          <span class="keyword">this</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      props = extend(extend(&#123;&#125;, bindObject), props)</span><br><span class="line">    &#125;</span><br><span class="line">    nodes = scopedSlotFn(props) || fallback</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    nodes = <span class="keyword">this</span>.$slots[name] || fallback</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> target = props &amp;&amp; props.slot</span><br><span class="line">  <span class="keyword">if</span> (target) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$createElement(<span class="string">'template'</span>, &#123; <span class="attr">slot</span>: target &#125;, nodes)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> nodes</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>render-slot</code> 的参数 <code>name</code> 代表插槽名称 <code>slotName</code>，<code>fallback</code> 代表插槽的默认内容生成的 <code>vnode</code> 数组。先忽略 <code>scoped-slot</code>，只看默认插槽逻辑。如果 <code>this.$slot[name]</code> 有值，就返回它对应的 <code>vnode</code> 数组，否则返回 <code>fallback</code>。那么这个 <code>this.$slot</code> 是哪里来的呢？我们知道子组件的 <code>init</code> 时机是在父组件执行 <code>patch</code> 过程的时候，那这个时候父组件已经编译完成了。并且子组件在 <code>init</code> 过程中会执行 <code>initRender</code> 函数，<code>initRender</code> 的时候获取到 <code>vm.$slot</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/render.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initRender</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  vm._vnode = <span class="literal">null</span> <span class="comment">// the root of the child tree</span></span><br><span class="line">  vm._staticTrees = <span class="literal">null</span> <span class="comment">// v-once cached trees</span></span><br><span class="line">  <span class="keyword">const</span> options = vm.$options</span><br><span class="line">  <span class="keyword">const</span> parentVnode = vm.$vnode = options._parentVnode <span class="comment">// the placeholder node in parent tree</span></span><br><span class="line">  <span class="keyword">const</span> renderContext = parentVnode &amp;&amp; parentVnode.context</span><br><span class="line">  vm.$slots = resolveSlots(options._renderChildren, renderContext)</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/core/instance/render-helpers/resolve-slots.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Runtime helper for resolving raw children VNodes into a slot object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resolveSlots</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  children: ?Array&lt;VNode&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  context: ?Component</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): </span>&#123; [key: string]: <span class="built_in">Array</span>&lt;VNode&gt; &#125; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!children || !children.length) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> slots = &#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = children.length; i &lt; l; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> child = children[i]</span><br><span class="line">    <span class="keyword">const</span> data = child.data</span><br><span class="line">    <span class="comment">// remove slot attribute if the node is resolved as a Vue slot node</span></span><br><span class="line">    <span class="keyword">if</span> (data &amp;&amp; data.attrs &amp;&amp; data.attrs.slot) &#123;</span><br><span class="line">      <span class="keyword">delete</span> data.attrs.slot</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// named slots should only be respected if the vnode was rendered in the</span></span><br><span class="line">    <span class="comment">// same context.</span></span><br><span class="line">    <span class="keyword">if</span> ((child.context === context || child.fnContext === context) &amp;&amp;</span><br><span class="line">      data &amp;&amp; data.slot != <span class="literal">null</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">const</span> name = data.slot</span><br><span class="line">      <span class="keyword">const</span> slot = (slots[name] || (slots[name] = []))</span><br><span class="line">      <span class="keyword">if</span> (child.tag === <span class="string">'template'</span>) &#123;</span><br><span class="line">        slot.push.apply(slot, child.children || [])</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        slot.push(child)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      (slots.default || (slots.default = [])).push(child)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ignore slots that contains only whitespace</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">in</span> slots) &#123;</span><br><span class="line">    <span class="keyword">if</span> (slots[name].every(isWhitespace)) &#123;</span><br><span class="line">      <span class="keyword">delete</span> slots[name]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> slots</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>resolveSlots</code> 方法接收 2 个参数，第一个参数 <code>chilren</code> 对应的是父 <code>vnode</code> 的 <code>children</code>，在我们的例子中就是父组件包裹的内容。第二个参数 <code>context</code> 是父 <code>vnode</code> 的上下文，也就是父组件的 <code>vm</code> 实例。</p>
<p><code>resolveSlots</code> 函数的逻辑就是遍历 <code>chilren</code>，拿到每一个 <code>child</code> 的 <code>data</code>，然后通过 <code>data.slot</code> 获取到插槽名称，这个 <code>slot</code> 就是我们之前编译父组件在 <code>codegen</code> 阶段设置的 <code>data.slot</code>。接着以插槽名称为 <code>key</code> 把 <code>child</code> 添加到 <code>slots</code> 中，如果 <code>data.slot</code> 不存在，则是默认插槽的内容，则把对应的 <code>child</code> 添加到 <code>slots.defaults</code> 中。这样就获取到整个 <code>slots</code>，它是一个对象，<code>key</code> 是插槽名称，<code>value</code> 是一个 <code>vnode</code> 类型的数组，因为它可以有多个同名插槽。</p>
<p>这样我们就拿到了 <code>vm.$slots</code> 了，回到 <code>renderSlot</code> 函数，<code>const slotNodes = this.$slots[name]</code>，我们也就能根据插槽名称获取到对应的 <code>vnode</code> 数组了，这个数组里的 <code>vnode</code> 都是在父组件创建的，这样就实现了在父组替换子组件插槽的内容了。</p>
<p>对应的 <code>slot</code> 渲染成 <code>vnodes</code>，作为当前组件渲染 <code>vnode</code> 的 <code>children</code>。</p>
<p>我们知道在普通插槽中，父组件应用到子组件插槽里的数据都是绑定到父组件的，因为它渲染成 vnode 的时机的上下文是父组件的实例。但是在一些实际开发中，我们想通过子组件的一些数据来决定父组件实现插槽的逻辑，Vue 提供了另一种插槽——作用域插槽，接下来我们就来分析一下它的实现原理。</p>
<h2 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h2><blockquote>
<p>自 2.6.0 起有所更新。已废弃的使用 <code>slot-scope</code> attribute 的语法在<a href="https://cn.vuejs.org/v2/guide/components-slots.html#%E5%BA%9F%E5%BC%83%E4%BA%86%E7%9A%84%E8%AF%AD%E6%B3%95" target="_blank" rel="noopener">这里</a>。</p>
</blockquote>
<h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><p>为了让某些数据在父级的插槽内容中可用，我们可以将数据作为 <code>&lt;slot&gt;</code> 元素的一个 attribute 绑定上去：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"slot-template"</span>&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;slot name=<span class="string">"user"</span> v-bind:user=<span class="string">"userInfo"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line">  ...</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">data()&#123;</span></span><br><span class="line"><span class="regexp">    return&#123;</span></span><br><span class="line"><span class="regexp">        userInfo: &#123;</span></span><br><span class="line"><span class="regexp">            name: '张三',</span></span><br><span class="line"><span class="regexp">            firstName: '张',</span></span><br><span class="line"><span class="regexp">            lastName: '三',</span></span><br><span class="line"><span class="regexp">            sex: '男'</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="用法-2"><a href="#用法-2" class="headerlink" title="用法"></a>用法</h3><p>绑定在 <code>&lt;slot&gt;</code> 元素上的 attribute 被称为插槽 prop。现在在父级作用域中，我们可以使用带值的 <code>v-slot</code> 来定义我们提供的插槽 prop 的名字：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:user</span>=<span class="string">"slotProps"</span>&gt;</span></span><br><span class="line">    &#123;&#123; slotProps.user.name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// 渲染：=&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"slot-template"</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  张三</span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这个例子中，我们选择将包含所有插槽 prop 的对象命名为 slotProps，但你也可以使用任意你喜欢的名字。</p>
</blockquote>
<h3 id="解构插槽Prop"><a href="#解构插槽Prop" class="headerlink" title="解构插槽Prop"></a>解构插槽Prop</h3><p><code>v-slot</code> 的值实际上可以是任何能够作为函数定义中的参数的 JavaScript 表达式。所以在支持的环境下 (<a href="https://cn.vuejs.org/v2/guide/single-file-components.html" target="_blank" rel="noopener">单文件组件</a>或<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9" target="_blank" rel="noopener">现代浏览器</a>)，你也可以使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#%E8%A7%A3%E6%9E%84%E5%AF%B9%E8%B1%A1" target="_blank" rel="noopener">ES2015 解构</a>来传入具体的插槽 prop，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot-template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:user</span>=<span class="string">"&#123; user &#125;"</span>&gt;</span></span><br><span class="line">    &#123;&#123; user.name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 也可以为 prop 重命名 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:user</span>=<span class="string">"&#123; user:person &#125;"</span>&gt;</span></span><br><span class="line">    &#123;&#123; person.name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 甚至可以定义后备内容，用于插槽 prop 是 undefined 的情形 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:user</span>=<span class="string">"&#123; user = &#123; name: '李四'&#125; &#125;"</span>&gt;</span></span><br><span class="line">    &#123;&#123; person.name &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样可以使模板更简洁，尤其是在该插槽提供了多个 prop 的时候。</p>
<h2 id="编译作用域"><a href="#编译作用域" class="headerlink" title="编译作用域"></a>编译作用域</h2><p>当你想在一个插槽中使用数据时，例如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot-template</span> <span class="attr">type</span>=<span class="string">"xxx"</span>&gt;</span></span><br><span class="line">  Logged in as &#123;&#123; name &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该插槽跟模板的其它地方一样可以访问相同的实例 property (也就是相同的“作用域”)，而不能访问 <code>&lt;slot-template&gt;</code> 的作用域。例如<code>type</code>是访问不到的：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot-template</span> <span class="attr">type</span>=<span class="string">"xxx"</span>&gt;</span></span><br><span class="line">  Logged in as &#123;&#123; name &#125;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--这里的type会是undefined，因为其 (指该插槽的) 内容是传递给&lt;slot-template&gt;的而不是在 &lt;slot-template&gt; 组件内部定义的--&gt;</span></span><br><span class="line">  &#123;&#123; type &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">slot-template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>父级模板里的所有内容都是在父级作用域中编译的；子模板里的所有内容都是在子作用域中编译的。</p>
</blockquote>
<h2 id="总结示例"><a href="#总结示例" class="headerlink" title="总结示例"></a>总结示例</h2><p>插槽 prop 允许我们将插槽转换为可复用的模板，这些模板可以基于输入的 prop 渲染出不同的内容。这在设计封装数据逻辑同时允许父级组件自定义部分布局的可复用组件时是最有用的。</p>
<p>例如，我们实现一个列表组件：<br>我们可以将每个 item 作为父级组件的插槽，以此通过父级组件对其进行控制，然后将 item 作为一个插槽 prop 进行绑定：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">"item in lists"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"item.id"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 我们为每个 item 准备了一个插槽，将 `item` 对象作为一个插槽的 prop 传入。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"item"</span> <span class="attr">:item</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 后备内容 --&gt;</span></span><br><span class="line">      &#123;&#123; item.label &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在当我们使用列表组件的时候，我们可以选择为 item 定义一个不一样的 <code>&lt;template&gt;</code> 作为替代方案，并且可以从子组件获取数据：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">custom-list</span> <span class="attr">:lists</span>=<span class="string">"lists"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">item</span>=<span class="string">"&#123; item &#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"custom-item"</span>&gt;</span>&#123;&#123; item.label &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">custom-list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h2><p>现在我们已经了解了作用域插槽的用法，下面让我们来看看Vue内部的实现吧!<br>还是要从编译阶段说起，先编译父组件，再编译子组件。</p>
<h3 id="父组件编译阶段"><a href="#父组件编译阶段" class="headerlink" title="父组件编译阶段"></a>父组件编译阶段</h3><p>父组件编译在<code>parse</code>阶段，同样会执行<code>processSlotContent</code>函数去处理 <code>scoped-slot</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// handle content being passed to a component as slot,</span></span><br><span class="line"><span class="comment">// e.g. &lt;template slot="xxx"&gt;, &lt;div slot-scope="xxx"&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">processSlotContent</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> slotScope</span><br><span class="line">  <span class="comment">/** v2.6 之前的兼容处理 */</span></span><br><span class="line">  <span class="keyword">if</span> (el.tag === <span class="string">'template'</span>) &#123;</span><br><span class="line">    slotScope = getAndRemoveAttr(el, <span class="string">'scope'</span>)</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; slotScope) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">`the "scope" attribute for scoped slots have been deprecated and `</span> +</span><br><span class="line">        <span class="string">`replaced by "slot-scope" since 2.5. The new "slot-scope" attribute `</span> +</span><br><span class="line">        <span class="string">`can also be used on plain elements in addition to &lt;template&gt; to `</span> +</span><br><span class="line">        <span class="string">`denote scoped slots.`</span>,</span><br><span class="line">        el.rawAttrsMap[<span class="string">'scope'</span>],</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    el.slotScope = slotScope || getAndRemoveAttr(el, <span class="string">'slot-scope'</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((slotScope = getAndRemoveAttr(el, <span class="string">'slot-scope'</span>))) &#123;</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; el.attrsMap[<span class="string">'v-for'</span>]) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">`Ambiguous combined usage of slot-scope and v-for on &lt;<span class="subst">$&#123;el.tag&#125;</span>&gt; `</span> +</span><br><span class="line">        <span class="string">`(v-for takes higher priority). Use a wrapper &lt;template&gt; for the `</span> +</span><br><span class="line">        <span class="string">`scoped slot to make it clearer.`</span>,</span><br><span class="line">        el.rawAttrsMap[<span class="string">'slot-scope'</span>],</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    el.slotScope = slotScope</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/** v2.6 新增 v-slot*/</span></span><br><span class="line">  <span class="comment">// 2.6 v-slot syntax</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NEW_SLOT_SYNTAX) &#123;</span><br><span class="line">    <span class="keyword">if</span> (el.tag === <span class="string">'template'</span>) &#123;</span><br><span class="line">      <span class="comment">// v-slot on &lt;template&gt;</span></span><br><span class="line">      <span class="comment">// 在最上面定义的 const slotRE = /^v-slot(:|$)|^#/</span></span><br><span class="line">      <span class="keyword">const</span> slotBinding = getAndRemoveAttrByRegex(el, slotRE)</span><br><span class="line">      <span class="keyword">if</span> (slotBinding) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">// export const emptySlotScopeToken = `_empty_`</span></span><br><span class="line">        el.slotScope = slotBinding.value || emptySlotScopeToken <span class="comment">// force it into a scoped slot for perf</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// v-slot on component, denotes default slot</span></span><br><span class="line">      <span class="keyword">const</span> slotBinding = getAndRemoveAttrByRegex(el, slotRE)</span><br><span class="line">      <span class="keyword">if</span> (slotBinding) &#123;</span><br><span class="line">        ...</span><br><span class="line">        slotContainer.slotScope = slotBinding.value || emptySlotScopeToken</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSlotName</span> (<span class="params">binding</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> name = binding.name.replace(slotRE, <span class="string">''</span>)</span><br><span class="line">  <span class="keyword">if</span> (!name) &#123;</span><br><span class="line">    <span class="keyword">if</span> (binding.name[<span class="number">0</span>] !== <span class="string">'#'</span>) &#123;</span><br><span class="line">      name = <span class="string">'default'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">`v-slot shorthand syntax requires a slot name.`</span>,</span><br><span class="line">        binding</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 动态插槽名称解析 const dynamicArgRE = /^\[.*\]$/</span></span><br><span class="line">  <span class="keyword">return</span> dynamicArgRE.test(name)</span><br><span class="line">    <span class="comment">// dynamic [name]</span></span><br><span class="line">    ? &#123; <span class="attr">name</span>: name.slice(<span class="number">1</span>, <span class="number">-1</span>), <span class="attr">dynamic</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    <span class="comment">// static name</span></span><br><span class="line">    : &#123; <span class="attr">name</span>: <span class="string">`"<span class="subst">$&#123;name&#125;</span>"`</span>, <span class="attr">dynamic</span>: <span class="literal">false</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这块逻辑很简单，读取 <code>scoped-slot</code> 属性并赋值给当前 AST 元素节点的 <code>slotScope</code> 属性，接下来在构造 AST 树的时候，会执行以下逻辑：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/parser/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Convert HTML string to AST.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">parse</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  template: string,</span></span></span><br><span class="line"><span class="function"><span class="params">  options: CompilerOptions</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">ASTElement</span> | <span class="title">void</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">if</span> (currentParent &amp;&amp; !element.forbidden) &#123;</span><br><span class="line">      <span class="keyword">if</span> (element.elseif || element.else) &#123;</span><br><span class="line">        processIfConditions(element, currentParent)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (element.slotScope) &#123;</span><br><span class="line">          <span class="comment">// scoped slot</span></span><br><span class="line">          <span class="comment">// keep it in the children list so that v-else(-if) conditions can</span></span><br><span class="line">          <span class="comment">// find it as the prev node.</span></span><br><span class="line">          <span class="keyword">const</span> name = element.slotTarget || <span class="string">'"default"'</span></span><br><span class="line">          ;(currentParent.scopedSlots || (currentParent.scopedSlots = &#123;&#125;))[name] = element</span><br><span class="line">        &#125;</span><br><span class="line">        currentParent.children.push(element)</span><br><span class="line">        element.parent = currentParent</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到对于拥有 <code>scopedSlot</code> 属性的 AST 元素节点而言，是不会作为 <code>children</code> 添加到当前 AST 树中，而是存到父 AST 元素节点的 <code>scopedSlots</code> 属性上，它是一个对象，以插槽名称 <code>name</code> 为 <code>key</code>。</p>
<p>然后在 <code>genData</code> 的过程，会对 <code>scopedSlots</code> 做处理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/codegen/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">genData</span> (<span class="params">el: ASTElement, state: CodegenState</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// scoped slots</span></span><br><span class="line">  <span class="keyword">if</span> (el.scopedSlots) &#123;</span><br><span class="line">    data += <span class="string">`<span class="subst">$&#123;genScopedSlots(el, el.scopedSlots, state)&#125;</span>,`</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genScopedSlots</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  el: ASTElement,</span></span></span><br><span class="line"><span class="function"><span class="params">  slots: &#123; [key: string]: ASTElement &#125;,</span></span></span><br><span class="line"><span class="function"><span class="params">  state: CodegenState</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="comment">// by default scoped slots are considered "stable", this allows child</span></span><br><span class="line">  <span class="comment">// components with only scoped slots to skip forced updates from parent.</span></span><br><span class="line">  <span class="comment">// but in some cases we have to bail-out of this optimization</span></span><br><span class="line">  <span class="comment">// for example if the slot contains dynamic names, has v-if or v-for on them...</span></span><br><span class="line">  <span class="keyword">let</span> needsForceUpdate = el.for || <span class="built_in">Object</span>.keys(slots).some(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> slot = slots[key]</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      slot.slotTargetDynamic ||</span><br><span class="line">      slot.if ||</span><br><span class="line">      slot.for ||</span><br><span class="line">      containsSlotChild(slot) <span class="comment">// is passing down slot from parent which may be dynamic</span></span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// #9534: if a component with scoped slots is inside a conditional branch,</span></span><br><span class="line">  <span class="comment">// it's possible for the same component to be reused but with different</span></span><br><span class="line">  <span class="comment">// compiled slot content. To avoid that, we generate a unique key based on</span></span><br><span class="line">  <span class="comment">// the generated code of all the slot contents.</span></span><br><span class="line">  <span class="keyword">let</span> needsKey = !!el.if</span><br><span class="line"></span><br><span class="line">  <span class="comment">// OR when it is inside another scoped slot or v-for (the reactivity may be</span></span><br><span class="line">  <span class="comment">// disconnected due to the intermediate scope variable)</span></span><br><span class="line">  <span class="comment">// #9438, #9506</span></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> this can be further optimized by properly analyzing in-scope bindings</span></span><br><span class="line">  <span class="comment">// and skip force updating ones that do not actually use scope variables.</span></span><br><span class="line">  <span class="keyword">if</span> (!needsForceUpdate) &#123;</span><br><span class="line">    <span class="keyword">let</span> parent = el.parent</span><br><span class="line">    <span class="keyword">while</span> (parent) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        (parent.slotScope &amp;&amp; parent.slotScope !== emptySlotScopeToken) ||</span><br><span class="line">        parent.for</span><br><span class="line">      ) &#123;</span><br><span class="line">        needsForceUpdate = <span class="literal">true</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (parent.if) &#123;</span><br><span class="line">        needsKey = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">      parent = parent.parent</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> generatedSlots = <span class="built_in">Object</span>.keys(slots)</span><br><span class="line">    .map(<span class="function"><span class="params">key</span> =&gt;</span> genScopedSlot(slots[key], state))</span><br><span class="line">    .join(<span class="string">','</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`scopedSlots:_u([<span class="subst">$&#123;generatedSlots&#125;</span>]<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">    needsForceUpdate ? <span class="string">`,null,true`</span> : <span class="string">``</span></span></span></span><br><span class="line"><span class="string"><span class="subst">  &#125;</span><span class="subst">$&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">    !needsForceUpdate &amp;&amp; needsKey ? <span class="string">`,null,false,<span class="subst">$&#123;hash(generatedSlots)&#125;</span>`</span> : <span class="string">``</span></span></span></span><br><span class="line"><span class="string"><span class="subst">  &#125;</span>)`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genScopedSlot</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  el: ASTElement,</span></span></span><br><span class="line"><span class="function"><span class="params">  state: CodegenState</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isLegacySyntax = el.attrsMap[<span class="string">'slot-scope'</span>]</span><br><span class="line">  <span class="keyword">if</span> (el.if &amp;&amp; !el.ifProcessed &amp;&amp; !isLegacySyntax) &#123;</span><br><span class="line">    <span class="keyword">return</span> genIf(el, state, genScopedSlot, <span class="string">`null`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (el.for &amp;&amp; !el.forProcessed) &#123;</span><br><span class="line">    <span class="keyword">return</span> genFor(el, state, genScopedSlot)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> slotScope = el.slotScope === emptySlotScopeToken</span><br><span class="line">    ? <span class="string">``</span></span><br><span class="line">    : <span class="built_in">String</span>(el.slotScope)</span><br><span class="line">  <span class="keyword">const</span> fn = <span class="string">`function(<span class="subst">$&#123;slotScope&#125;</span>)&#123;`</span> +</span><br><span class="line">    <span class="string">`return <span class="subst">$&#123;el.tag === <span class="string">'template'</span></span></span></span><br><span class="line"><span class="string"><span class="subst">      ? el.<span class="keyword">if</span> &amp;&amp; isLegacySyntax</span></span></span><br><span class="line"><span class="string"><span class="subst">        ? <span class="string">`(<span class="subst">$&#123;el.<span class="keyword">if</span>&#125;</span>)?<span class="subst">$&#123;genChildren(el, state) || <span class="string">'undefined'</span>&#125;</span>:undefined`</span></span></span></span><br><span class="line"><span class="string"><span class="subst">        : genChildren(el, state) || <span class="string">'undefined'</span></span></span></span><br><span class="line"><span class="string"><span class="subst">      : genElement(el, state)</span></span></span><br><span class="line"><span class="string"><span class="subst">    &#125;</span>&#125;`</span></span><br><span class="line">  <span class="comment">// reverse proxy v-slot without scope on this.$slots</span></span><br><span class="line">  <span class="keyword">const</span> reverseProxy = slotScope ? <span class="string">``</span> : <span class="string">`,proxy:true`</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`&#123;key:<span class="subst">$&#123;el.slotTarget || <span class="string">`"default"`</span>&#125;</span>,fn:<span class="subst">$&#123;fn&#125;</span><span class="subst">$&#123;reverseProxy&#125;</span>&#125;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>genScopedSlots</code> 就是对 <code>scopedSlots</code> 对象遍历，执行 <code>genScopedSlot</code>，并把结果用逗号拼接，而 <code>genScopedSlot</code> 是先生成一段函数代码，并且函数的参数就是我们的 <code>slotScope</code>，也就是写在标签属性上的 <code>scoped-slot</code> 对应的值，然后再返回一个对象，<code>key</code> 为插槽名称，<code>fn</code> 为生成的函数代码。</p>
<p>它和普通插槽父组件编译结果的一个很明显的区别就是没有 children 了，data 部分多了一个对象，并且执行了 _u 方法，在编译章节我们了解到，_u 函数对的就是 resolveScopedSlots 方法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/render-helpers/index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">installRenderHelpers</span> (<span class="params">target: any</span>) </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  target._t = renderSlot</span><br><span class="line">  target._u = resolveScopedSlots</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/core/instance/render-heplpers/resolve-slots.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">resolveScopedSlots</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  fns: ScopedSlotsData, <span class="regexp">//</span> see flow<span class="regexp">/vnode</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  res?: Object,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  /</span><span class="regexp">/ the following are added in 2.6</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  hasDynamicKeys?: boolean,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  contentHashKey?: number</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">): &#123; [key: string]: Function, $stable: boolean &#125; &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  res = res || &#123; $stable: !hasDynamicKeys &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  for (let i = 0; i &lt; fns.length; i++) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">    const slot = fns[i]</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">    if (Array.isArray(slot)) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">      resolveScopedSlots(slot, res, hasDynamicKeys)</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">    &#125; else if (slot) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">      /</span><span class="regexp">/ marker for reverse proxying v-slot without scope on this.$slots</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">      if (slot.proxy) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">        slot.fn.proxy = true</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">      &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">      res[slot.key] = slot.fn</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">    &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  if (contentHashKey) &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">    (res: any).$key = contentHashKey</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  &#125;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">  return res</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="regexp">&#125;</span></span></span></span><br></pre></td></tr></table></figure>

<p>其中，<code>fns</code> 是一个数组，每一个数组元素都有一个 <code>key</code> 和一个 <code>fn</code>，<code>key</code> 对应的是插槽的名称，<code>fn</code> 对应一个函数。整个逻辑就是遍历这个 <code>fns</code> 数组，生成一个对象，对象的 <code>key</code> 就是插槽名称，<code>value</code> 就是函数。这个函数的执行时机稍后我们会介绍。</p>
<h3 id="子组件编译阶段"><a href="#子组件编译阶段" class="headerlink" title="子组件编译阶段"></a>子组件编译阶段</h3><p>接着我们再来看一下子组件的编译，和普通插槽的过程基本相同，唯一一点区别是在 <code>genSlot</code> 的时候它会对 <code>attrs</code> 和 <code>v-bind</code> 做处理：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/compiler/codegen/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genSlot</span> (<span class="params">el: ASTElement, state: CodegenState</span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> slotName = el.slotName || <span class="string">'"default"'</span></span><br><span class="line">  <span class="keyword">const</span> children = genChildren(el, state)</span><br><span class="line">  <span class="keyword">let</span> res = <span class="string">`_t(<span class="subst">$&#123;slotName&#125;</span><span class="subst">$&#123;children ? <span class="string">`,<span class="subst">$&#123;children&#125;</span>`</span> : <span class="string">''</span>&#125;</span>`</span></span><br><span class="line">  <span class="keyword">const</span> attrs = el.attrs || el.dynamicAttrs</span><br><span class="line">    ? genProps((el.attrs || []).concat(el.dynamicAttrs || []).map(<span class="function"><span class="params">attr</span> =&gt;</span> (&#123;</span><br><span class="line">        <span class="comment">// slot props are camelized</span></span><br><span class="line">        name: camelize(attr.name),</span><br><span class="line">        value: attr.value,</span><br><span class="line">        dynamic: attr.dynamic</span><br><span class="line">      &#125;)))</span><br><span class="line">    : <span class="literal">null</span></span><br><span class="line">  <span class="keyword">const</span> bind = el.attrsMap[<span class="string">'v-bind'</span>]</span><br><span class="line">  <span class="keyword">if</span> ((attrs || bind) &amp;&amp; !children) &#123;</span><br><span class="line">    res += <span class="string">`,null`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (attrs) &#123;</span><br><span class="line">    res += <span class="string">`,<span class="subst">$&#123;attrs&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (bind) &#123;</span><br><span class="line">    res += <span class="string">`<span class="subst">$&#123;attrs ? <span class="string">''</span> : <span class="string">',null'</span>&#125;</span>,<span class="subst">$&#123;bind&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res + <span class="string">')'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译后是执行<code>_t</code> 方法（我们之前介绍过），对应的是 <code>renderSlot</code> 方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/render-heplpers/render-slot.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Runtime helper for rendering &lt;slot&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">renderSlot</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  name: string,</span></span></span><br><span class="line"><span class="function"><span class="params">  fallback: ?Array&lt;VNode&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  props: ?Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  bindObject: ?Object</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): ?<span class="title">Array</span>&lt;<span class="title">VNode</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> scopedSlotFn = <span class="keyword">this</span>.$scopedSlots[name]</span><br><span class="line">  <span class="keyword">let</span> nodes</span><br><span class="line">  <span class="keyword">if</span> (scopedSlotFn) &#123; <span class="comment">// scoped slot</span></span><br><span class="line">    props = props || &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (bindObject) &#123;</span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; !isObject(bindObject)) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="string">'slot v-bind without argument expects an Object'</span>,</span><br><span class="line">          <span class="keyword">this</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      props = extend(extend(&#123;&#125;, bindObject), props)</span><br><span class="line">    &#125;</span><br><span class="line">    nodes = scopedSlotFn(props) || fallback</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    nodes = <span class="keyword">this</span>.$slots[name] || fallback</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> target = props &amp;&amp; props.slot</span><br><span class="line">  <span class="keyword">if</span> (target) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.$createElement(<span class="string">'template'</span>, &#123; <span class="attr">slot</span>: target &#125;, nodes)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> nodes</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们只关注作用域插槽的逻辑，那么这个 <code>this.$scopedSlots</code> 又是在什么地方定义的呢，原来在子组件的渲染函数执行前，在 <code>vm_render</code> 方法内，有这么一段逻辑:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core/instance/render.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initRender</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  vm._vnode = <span class="literal">null</span> <span class="comment">// the root of the child tree</span></span><br><span class="line">  vm._staticTrees = <span class="literal">null</span> <span class="comment">// v-once cached trees</span></span><br><span class="line">  <span class="keyword">const</span> options = vm.$options</span><br><span class="line">  <span class="keyword">const</span> parentVnode = vm.$vnode = options._parentVnode <span class="comment">// the placeholder node in parent tree</span></span><br><span class="line">  <span class="keyword">const</span> renderContext = parentVnode &amp;&amp; parentVnode.context</span><br><span class="line">  vm.$slots = resolveSlots(options._renderChildren, renderContext)</span><br><span class="line">  vm.$scopedSlots = emptyObject</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">renderMixin</span> (<span class="params">Vue: Class&lt;Component&gt;</span>) </span>&#123;</span><br><span class="line">  Vue.prototype._render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>): <span class="title">VNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">    <span class="keyword">const</span> &#123; render, _parentVnode &#125; = vm.$options</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_parentVnode) &#123;</span><br><span class="line">      vm.$scopedSlots = normalizeScopedSlots(</span><br><span class="line">        _parentVnode.data.scopedSlots,</span><br><span class="line">        vm.$slots</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> vnode</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个 <code>_parentVNode.data.scopedSlots</code> 对应的就是我们在父组件通过执行 <code>resolveScopedSlots</code> 返回的对象。所以回到 <code>genSlot</code> 函数，我们就可以通过插槽的名称拿到对应的 <code>scopedSlotFn</code>，然后把相关的数据扩展到 <code>props</code> 上，作为函数的参数传入，原来之前我们提到的函数这个时候执行，然后返回生成的 <code>vnodes</code>，为后续渲染节点用。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过上面的分析，我们了解了普通插槽和作用域插槽的实现。它们有一个很大的差别是数据作用域，普通插槽是在父组件编译和渲染阶段生成 <code>vnodes</code>，所以数据的作用域是父组件实例，子组件渲染的时候直接拿到这些渲染好的 <code>vnodes</code>。而对于作用域插槽，父组件在编译和渲染阶段并不会直接生成 <code>vnodes</code>，而是在父节点 <code>vnode</code> 的 <code>data</code> 中保留一个 <code>scopedSlots</code> 对象，存储着不同名称的插槽以及它们对应的渲染函数，只有在编译和渲染子组件阶段才会执行这个渲染函数生成 vnodes，由于是在子组件环境执行的，所以对应的数据作用域是子组件实例。</p>
<p>简单地说，两种插槽的目的都是让子组件 <code>slot</code> 占位符生成的内容由父组件来决定，但数据的作用域会根据它们 <code>vnodes</code> 渲染时机不同而不同。</p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Vue源码系列" >
    <span class="tag-code">Vue源码系列</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2020/06/17/regular/">
        <span class="nav-arrow">← </span>
        
          常用正则表达式
        
      </a>
    
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
      <div class="money-like">
        <div class="reward-btn">
          赏
          <span class="money-code">
            <span class="alipay-code">
              <div class="code-image"></div>
              <b>使用支付宝打赏</b>
            </span>
            <span class="wechat-code">
              <div class="code-image"></div>
              <b>使用微信打赏</b>
            </span>
          </span>
        </div>
        <p class="notice">若你觉得我的文章对你有帮助，欢迎点击上方按钮对我打赏</p>
      </div>
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#Vue源码系列之slot插槽"><span class="toc-nav-text">Vue源码系列之slot插槽</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#前言"><span class="toc-nav-text">前言</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#默认插槽"><span class="toc-nav-text">默认插槽</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#语法"><span class="toc-nav-text">语法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#用法"><span class="toc-nav-text">用法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#后备内容"><span class="toc-nav-text">后备内容</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#具名插槽"><span class="toc-nav-text">具名插槽</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#语法-1"><span class="toc-nav-text">语法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#用法-1"><span class="toc-nav-text">用法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#缩写"><span class="toc-nav-text">缩写</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#动态插槽名"><span class="toc-nav-text">动态插槽名</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#源码"><span class="toc-nav-text">源码</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#编译父组件阶段"><span class="toc-nav-text">编译父组件阶段</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#编译子组件阶段"><span class="toc-nav-text">编译子组件阶段</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#作用域插槽"><span class="toc-nav-text">作用域插槽</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#语法-2"><span class="toc-nav-text">语法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#用法-2"><span class="toc-nav-text">用法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解构插槽Prop"><span class="toc-nav-text">解构插槽Prop</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#编译作用域"><span class="toc-nav-text">编译作用域</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#总结示例"><span class="toc-nav-text">总结示例</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#源码-1"><span class="toc-nav-text">源码</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#父组件编译阶段"><span class="toc-nav-text">父组件编译阶段</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#子组件编译阶段"><span class="toc-nav-text">子组件编译阶段</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#总结"><span class="toc-nav-text">总结</span></a></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://yoursite.com/2020/09/10/vueSourceCode-slot/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>



  <script>
    var gitmentConfig = "zhugexiaoxiaoliang";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "Vue源码系列之slot插槽",
        owner: "zhugexiaoxiaoliang",
        repo: "https://zhugexiaoxiaoliang.github.io",
        oauth: {
          client_id: "a893559541b0f60577b0",
          client_secret: "793cda806874db8a8f81e91b137427107b4f95af"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  </script>




    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2020 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Website by <a href="https://github.com/zhugexiaoxiaoliang" target="_blank" rel="noopener">MaReine</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>

  </body>
</html>